<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rebuild Resume</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
    .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    textarea { width: 100%; height: 200px; resize: vertical; padding: 10px; margin-bottom: 20px; border-radius: 4px; border: 1px solid #ccc; }
    #txtAddInfo { height: 100px; }
    button { display: block; margin: 0 auto; padding: 10px 20px; font-size: 16px; border-radius: 5px; border: none; background-color: #007BFF; color: white; cursor: pointer; }
    button:hover { background-color: #0056b3; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Rebuild Resume</h1>
    <label>Job Description</label>
    <textarea id="txtJD" maxlength="10000"></textarea>

    <label>Existing Resume</label>
    <textarea id="txtExRes" maxlength="10000"></textarea>

    <label>Additional Information</label>
    <textarea id="txtAddInfo" maxlength="700"></textarea>

    <button onclick="buildResume()">Build Resume</button>
  </div>

  <script>
    async function buildResume() {
      const jd = document.getElementById('txtJD').value.trim();
      const resume = document.getElementById('txtExRes').value.trim();
      const addInfo = document.getElementById('txtAddInfo').value.trim();

      if (jd.length < 500 || resume.length < 500) {
        alert("Please ensure both Job Description and Existing Resume have at least 500 characters.");
        return;
      }

      const prompt = `You are an expert ATS (Applicant Tracking System) who scans for resumes to match the job description. Now, as an ATS, compare the given resume with the job description, and modify the resume to suit the job description. Keep the original structure of the resume. Carefully add keywords and make sure to keep a professional tone while not sounding like AI created.\n\nHere is the Job Description:\n${jd}\n\nResume:\n${resume}\n\n${addInfo ? addInfo : ''}`;

      try {
        const [chatgptRes, geminiRes, writerRes] = await Promise.all([
          fetch('/api/chatgpt', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
          }),
          fetch('/api/gemini', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
          }),
          fetch('/api/writer', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
          })
        ]);

        const chatgptText = await chatgptRes.text();
        const geminiText = await geminiRes.text();
        const writerText = await writerRes.text();

        localStorage.setItem("chatgptResult", chatgptText);
        localStorage.setItem("geminiResult", geminiText);
        localStorage.setItem("writerResult", writerText);

        window.location.href = "output.html";

      } catch (err) {
        console.error("Error during resume generation:", err);
        alert("There was an error generating the resume. Check console for details.");
      }
    }
  </script>
</body>
</html>
